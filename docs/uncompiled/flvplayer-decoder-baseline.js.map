{"version":3,"file":"flvplayer-decoder-baseline.js","sources":["../../node_modules/@babel/runtime/helpers/classCallCheck.js","../../node_modules/@babel/runtime/helpers/createClass.js","../../node_modules/@babel/runtime/helpers/setPrototypeOf.js","../../node_modules/@babel/runtime/helpers/inherits.js","../../node_modules/@babel/runtime/helpers/typeof.js","../../node_modules/@babel/runtime/helpers/assertThisInitialized.js","../../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js","../../node_modules/@babel/runtime/helpers/getPrototypeOf.js","../../src/utils/index.js","../../src/decoder/video/index.js","../../src/decoder/video/baseline/renderer.js","../../src/decoder/video/baseline/index.js"],"sourcesContent":["function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","function _setPrototypeOf(o, p) {\n  module.exports = _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nmodule.exports = _setPrototypeOf;","var setPrototypeOf = require(\"./setPrototypeOf\");\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}\n\nmodule.exports = _inherits;","function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    module.exports = _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    module.exports = _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nmodule.exports = _typeof;","function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nmodule.exports = _assertThisInitialized;","var _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nvar assertThisInitialized = require(\"./assertThisInitialized\");\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return assertThisInitialized(self);\n}\n\nmodule.exports = _possibleConstructorReturn;","function _getPrototypeOf(o) {\n  module.exports = _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nmodule.exports = _getPrototypeOf;","export function isMobile() {\n    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n}\n\nexport function isWechat() {\n    return /MicroMessenger/i.test(navigator.userAgent);\n}\n\nexport function hasOwnProperty(obj, name) {\n    return Object.prototype.hasOwnProperty.call(obj, name);\n}\n\nexport function readBuffer(buffer) {\n    let index = 0;\n    function read(length) {\n        const tempUint8 = new Uint8Array(length);\n        for (let i = 0; i < length; i += 1) {\n            tempUint8[i] = buffer[index];\n            index += 1;\n        }\n        read.index = index;\n        return tempUint8;\n    }\n    read.index = 0;\n    return read;\n}\n\nexport function mergeBuffer(...buffers) {\n    const Cons = buffers[0].constructor;\n    return buffers.reduce((pre, val) => {\n        const merge = new Cons((pre.byteLength | 0) + (val.byteLength | 0));\n        merge.set(pre, 0);\n        merge.set(val, pre.byteLength | 0);\n        return merge;\n    }, new Cons());\n}\n\nexport function createWorker(workerString) {\n    return new Worker(URL.createObjectURL(new Blob([workerString], { type: 'application/javascript' })));\n}\n\nexport function secondToTime(second) {\n    const add0 = num => (num < 10 ? `0${num}` : String(num));\n    const hour = Math.floor(second / 3600);\n    const min = Math.floor((second - hour * 3600) / 60);\n    const sec = Math.floor(second - hour * 3600 - min * 60);\n    return (hour > 0 ? [hour, min, sec] : [min, sec]).map(add0).join(':');\n}\n\nexport function getNowTime() {\n    if (performance && typeof performance.now === 'function') {\n        return performance.now();\n    }\n    return Date.now();\n}\n\nexport function debounce(func, wait, context) {\n    let timeout;\n    function fn(...args) {\n        const later = function later() {\n            timeout = null;\n            func.apply(context, args);\n        };\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n    }\n\n    fn.clearTimeout = function ct() {\n        clearTimeout(timeout);\n    };\n\n    return fn;\n}\n\nexport function throttle(callback, delay) {\n    let isThrottled = false;\n    let args;\n    let context;\n\n    function fn(...args2) {\n        if (isThrottled) {\n            args = args2;\n            context = this;\n            return;\n        }\n\n        isThrottled = true;\n        callback.apply(this, args2);\n        setTimeout(() => {\n            isThrottled = false;\n            if (args) {\n                fn.apply(context, args);\n                args = null;\n                context = null;\n            }\n        }, delay);\n    }\n\n    return fn;\n}\n\nexport function clamp(num, a, b) {\n    return Math.max(Math.min(num, Math.max(a, b)), Math.min(a, b));\n}\n\nexport function setStyle(element, key, value) {\n    if (typeof key === 'object') {\n        Object.keys(key).forEach(item => {\n            setStyle(element, item, key[item]);\n        });\n    }\n    element.style[key] = value;\n    return element;\n}\n\nexport function getStyle(element, key, numberType = true) {\n    const value = getComputedStyle(element, null).getPropertyValue(key);\n    return numberType ? parseFloat(value) : value;\n}\n\nexport function loadScript(url, name) {\n    return new Promise((resolve, reject) => {\n        const $script = document.createElement('script');\n        $script.type = 'text/javascript';\n        $script.onload = () => {\n            if (window[name]) {\n                resolve(window[name]);\n            } else {\n                reject(new Error(`Unable to find global variable '${name}' from '${url}'`));\n            }\n        };\n        $script.onerror = () => {\n            reject(new Error(`Resource loading failed '${url}'`));\n        };\n        $script.src = url;\n        document.head.appendChild($script);\n    });\n}\n\nexport function proxyPropertys(target, ...sources) {\n    return sources.reduce((result, source) => {\n        Object.getOwnPropertyNames(source).forEach(key => {\n            if (!hasOwnProperty(result, key)) {\n                Object.defineProperty(result, key, Object.getOwnPropertyDescriptor(source, key));\n            } else {\n                throw new Error(`Target attribute name is duplicated: ${key}`);\n            }\n        });\n        return result;\n    }, target);\n}\n\nexport function calculationRate(callback) {\n    let totalSize = 0;\n    let lastTime = getNowTime();\n    return size => {\n        totalSize += size;\n        const thisTime = getNowTime();\n        const diffTime = thisTime - lastTime;\n        if (diffTime >= 1000) {\n            callback((totalSize / diffTime) * 1000);\n            lastTime = thisTime;\n            totalSize = 0;\n        }\n    };\n}\n","import { calculationRate } from '../../utils';\n\nexport default class VideoSuperDecoder {\n    constructor(flv, decoder) {\n        this.flv = flv;\n        const { options, player, debug } = flv;\n\n        this.ready = false;\n        this.playing = false;\n        this.playIndex = 0;\n        this.videoframes = [];\n        this.timestamps = [];\n        this.videoInputLength = 0;\n        this.videoOutputLength = 0;\n        this.decoding = false;\n        this.byteSize = 0;\n        this.loaded = 0;\n\n        this.decoderRate = calculationRate(rate => {\n            flv.emit('decoderRate', rate);\n        });\n\n        this.drawRate = calculationRate(rate => {\n            flv.emit('drawRate', rate);\n        });\n\n        flv.on('destroy', () => {\n            this.videoframes = [];\n            this.timestamps = [];\n            this.decoderWorker.terminate();\n            this.decoderWorker = null;\n            this.stop();\n        });\n\n        flv.on('befoerdecoding', timestamp => {\n            if (options.live && options.hasAudio && !this.playing && this.timestamps.length >= player.frameRate) {\n                this.timestamps.shift();\n            }\n            this.timestamps.push(timestamp);\n            this.decoding = true;\n            this.videoInputLength += 1;\n        });\n\n        flv.on('decoding', (message, byteSize) => {\n            if (options.live && options.hasAudio && !this.playing && this.timestamps.length >= player.frameRate) {\n                this.videoframes.shift();\n            }\n            this.videoframes.push(message);\n            this.byteSize += byteSize;\n            this.videoOutputLength += 1;\n            this.decoding = this.videoInputLength !== this.videoOutputLength;\n            this.loaded = this.videoOutputLength / player.frameRate;\n            flv.emit('videoLoaded', this.loaded);\n            this.decoderRate(1);\n            if (!this.ready && this.videoOutputLength === 1) {\n                this.ready = true;\n                if (options.live) {\n                    decoder.currentTime = this.timestamps[0] / 1000;\n                }\n                flv.emit('ready');\n            }\n        });\n\n        flv.on('timeupdate', currentTime => {\n            const index = this.playIndex;\n            const timestamp = this.timestamps[index];\n            if (timestamp !== undefined && currentTime * 1000 >= timestamp) {\n                if (this.draw(index)) {\n                    const framesSize = this.getFramesSize(index);\n                    if (\n                        (options.live || !options.cache) &&\n                        framesSize >= options.videoChunk * 64 &&\n                        this.videoframes.length - 1 > index &&\n                        this.timestamps.length - 1 > index\n                    ) {\n                        this.playIndex = 0;\n                        this.videoframes.splice(0, index + 1);\n                        this.timestamps.splice(0, index + 1);\n                        decoder.currentTime = this.timestamps[0] / 1000;\n                        debug.log('free-video-memory', {\n                            total: this.byteSize,\n                            yuv: framesSize,\n                            index,\n                        });\n                        flv.emit('freeVideoMemory', framesSize, index);\n                    } else {\n                        this.playIndex += 1;\n                    }\n                } else {\n                    if (!options.live) {\n                        this.stop();\n                    }\n                }\n            }\n        });\n    }\n\n    draw(index) {\n        const videoframe = this.videoframes[index];\n        if (!videoframe) return false;\n        this.renderer.drawFrame(videoframe);\n        this.drawRate(1);\n        return true;\n    }\n\n    play(startTime = 0) {\n        this.playing = true;\n        if (this.flv.options.live) {\n            this.playIndex = 0;\n            this.flv.decoder.currentTime = (this.timestamps[0] || 0) / 1000;\n        } else {\n            this.playIndex = this.timestamps.findIndex(timestamp => {\n                return timestamp >= startTime * 1000;\n            });\n        }\n    }\n\n    stop() {\n        this.playing = false;\n        if (this.flv.options.live) {\n            this.playIndex = 0;\n        }\n    }\n}\n","//\n//  Copyright (c) 2014 Sam Leitch. All rights reserved.\n//\n//  Permission is hereby granted, free of charge, to any person obtaining a copy\n//  of this software and associated documentation files (the \"Software\"), to\n//  deal in the Software without restriction, including without limitation the\n//  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n//  sell copies of the Software, and to permit persons to whom the Software is\n//  furnished to do so, subject to the following conditions:\n//\n//  The above copyright notice and this permission notice shall be included in\n//  all copies or substantial portions of the Software.\n//\n//  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n//  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n//  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n//  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n//  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n//  IN THE SOFTWARE.\n//\n\n/**\n * This class can be used to render output pictures from an H264bsdDecoder to a canvas element.\n * If available the content is rendered using WebGL.\n */\nexport default function H264bsdCanvas(canvas, forceNoGL) {\n    this.canvasElement = canvas;\n\n    if(!forceNoGL) this.initContextGL();\n\n    if(this.contextGL) {\n        this.initProgram();\n        this.initBuffers();\n        this.initTextures();\n    }\n}\n\n/**\n * Returns true if the canvas supports WebGL\n */\nH264bsdCanvas.prototype.isWebGL = function() {\n    return this.contextGL;\n}\n\n/**\n * Create the GL context from the canvas element\n */\nH264bsdCanvas.prototype.initContextGL = function() {\n    var canvas = this.canvasElement;\n    var gl = null;\n\n    var validContextNames = [\"webgl\", \"experimental-webgl\", \"moz-webgl\", \"webkit-3d\"];\n    var nameIndex = 0;\n\n    while(!gl && nameIndex < validContextNames.length) {\n        var contextName = validContextNames[nameIndex];\n        \n        try {\n            gl = canvas.getContext(contextName);\n        } catch (e) {\n            gl = null;\n        }\n\n        if(!gl || typeof gl.getParameter !== \"function\") {\n            gl = null;\n        }    \n\n        ++nameIndex;\n    }\n \n    this.contextGL = gl;\n}\n\n/**\n * Initialize GL shader program\n */\nH264bsdCanvas.prototype.initProgram = function() {\n    var gl = this.contextGL;\n\n    var vertexShaderScript = [\n        'attribute vec4 vertexPos;',\n        'attribute vec4 texturePos;',\n        'varying vec2 textureCoord;',\n\n        'void main()',\n        '{',\n            'gl_Position = vertexPos;',\n            'textureCoord = texturePos.xy;',\n        '}'\n        ].join('\\n');\n\n    var fragmentShaderScript = [\n        'precision highp float;',\n        'varying highp vec2 textureCoord;',\n        'uniform sampler2D ySampler;',\n        'uniform sampler2D uSampler;',\n        'uniform sampler2D vSampler;',\n        'const mat4 YUV2RGB = mat4',\n        '(',\n            '1.1643828125, 0, 1.59602734375, -.87078515625,',\n            '1.1643828125, -.39176171875, -.81296875, .52959375,',\n            '1.1643828125, 2.017234375, 0, -1.081390625,',\n            '0, 0, 0, 1',\n        ');',\n      \n        'void main(void) {',\n            'highp float y = texture2D(ySampler,  textureCoord).r;',\n            'highp float u = texture2D(uSampler,  textureCoord).r;',\n            'highp float v = texture2D(vSampler,  textureCoord).r;',\n            'gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;',\n        '}'\n        ].join('\\n');\n\n    var vertexShader = gl.createShader(gl.VERTEX_SHADER);\n    gl.shaderSource(vertexShader, vertexShaderScript);\n    gl.compileShader(vertexShader);\n    if(!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n        console.log('Vertex shader failed to compile: ' + gl.getShaderInfoLog(vertexShader));\n    }\n\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fragmentShader, fragmentShaderScript);\n    gl.compileShader(fragmentShader);\n    if(!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n        console.log('Fragment shader failed to compile: ' + gl.getShaderInfoLog(fragmentShader));\n    }\n\n    var program = gl.createProgram();\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.linkProgram(program);\n    if(!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n        console.log('Program failed to compile: ' + gl.getProgramInfoLog(program));\n    }\n\n    gl.useProgram(program);\n    \n    this.shaderProgram = program;\n}\n\n/**\n * Initialize vertex buffers and attach to shader program\n */\nH264bsdCanvas.prototype.initBuffers = function() {\n    var gl = this.contextGL;\n    var program = this.shaderProgram;\n\n    var vertexPosBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexPosBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([1, 1, -1, 1, 1, -1, -1, -1]), gl.STATIC_DRAW);\n\n    var vertexPosRef = gl.getAttribLocation(program, 'vertexPos');\n    gl.enableVertexAttribArray(vertexPosRef);\n    gl.vertexAttribPointer(vertexPosRef, 2, gl.FLOAT, false, 0, 0);\n\n    var texturePosBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, texturePosBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([1, 0, 0, 0, 1, 1, 0, 1]), gl.STATIC_DRAW);\n\n    var texturePosRef = gl.getAttribLocation(program, 'texturePos');\n    gl.enableVertexAttribArray(texturePosRef);\n    gl.vertexAttribPointer(texturePosRef, 2, gl.FLOAT, false, 0, 0);\n\n    this.texturePosBuffer = texturePosBuffer;\n}\n\n/**\n * Initialize GL textures and attach to shader program\n */\nH264bsdCanvas.prototype.initTextures = function() {\n    var gl = this.contextGL;\n    var program = this.shaderProgram;\n\n    var yTextureRef = this.initTexture();\n    var ySamplerRef = gl.getUniformLocation(program, 'ySampler');\n    gl.uniform1i(ySamplerRef, 0);\n    this.yTextureRef = yTextureRef;\n\n    var uTextureRef = this.initTexture();\n    var uSamplerRef = gl.getUniformLocation(program, 'uSampler');\n    gl.uniform1i(uSamplerRef, 1);\n    this.uTextureRef = uTextureRef;\n\n    var vTextureRef = this.initTexture();\n    var vSamplerRef = gl.getUniformLocation(program, 'vSampler');\n    gl.uniform1i(vSamplerRef, 2);\n    this.vTextureRef = vTextureRef;\n}\n\n/**\n * Create and configure a single texture\n */\nH264bsdCanvas.prototype.initTexture = function() {\n    var gl = this.contextGL;\n\n    var textureRef = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, textureRef);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n\n    return textureRef;\n}\n\n/**\n * Draw picture data to the canvas.\n * If this object is using WebGL, the data must be an I420 formatted ArrayBuffer,\n * Otherwise, data must be an RGBA formatted ArrayBuffer.\n */\nH264bsdCanvas.prototype.drawFrame = function(frame) {\n    var gl = this.contextGL;\n    var { width, height, data } = frame;\n    var croppingParams = null;\n    if(gl) {\n        this.drawNextOuptutPictureGL(width, height, croppingParams, new Uint8Array(data));\n    } else {\n        this.drawNextOuptutPictureRGBA(width, height, croppingParams, new Uint8Array(data));\n    }\n}\n\n/**\n * Draw the next output picture using WebGL\n */\nH264bsdCanvas.prototype.drawNextOuptutPictureGL = function(width, height, croppingParams, data) {\n    var gl = this.contextGL;\n    var texturePosBuffer = this.texturePosBuffer;\n    var yTextureRef = this.yTextureRef;\n    var uTextureRef = this.uTextureRef;\n    var vTextureRef = this.vTextureRef;    \n\n    if(croppingParams === null) {\n        gl.viewport(0, 0, width, height);\n    } else {\n        gl.viewport(0, 0, croppingParams.width, croppingParams.height);\n\n        var tTop = croppingParams.top / height;\n        var tLeft = croppingParams.left / width;\n        var tBottom = croppingParams.height / height;\n        var tRight = croppingParams.width / width;\n        var texturePosValues = new Float32Array([tRight, tTop, tLeft, tTop, tRight, tBottom, tLeft, tBottom]);\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, texturePosBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, texturePosValues, gl.DYNAMIC_DRAW);\n    }\n\n    var i420Data = data;\n\n    var yDataLength = width * height;\n    var yData = i420Data.subarray(0, yDataLength);\n    gl.activeTexture(gl.TEXTURE0);\n    gl.bindTexture(gl.TEXTURE_2D, yTextureRef);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.LUMINANCE, width, height, 0, gl.LUMINANCE, gl.UNSIGNED_BYTE, yData);\n\n    var cbDataLength = width/2 * height/2;\n    var cbData = i420Data.subarray(yDataLength, yDataLength + cbDataLength);\n    gl.activeTexture(gl.TEXTURE1);\n    gl.bindTexture(gl.TEXTURE_2D, uTextureRef);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.LUMINANCE, width/2, height/2, 0, gl.LUMINANCE, gl.UNSIGNED_BYTE, cbData);\n\n    var crDataLength = cbDataLength;\n    var crData = i420Data.subarray(yDataLength + cbDataLength, yDataLength + cbDataLength + crDataLength);\n    gl.activeTexture(gl.TEXTURE2);\n    gl.bindTexture(gl.TEXTURE_2D, vTextureRef);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.LUMINANCE, width/2, height/2, 0, gl.LUMINANCE, gl.UNSIGNED_BYTE, crData);\n\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4); \n}\n\n/**\n * Draw next output picture using ARGB data on a 2d canvas.\n */\nH264bsdCanvas.prototype.drawNextOuptutPictureRGBA = function(width, height, croppingParams, data) {\n    var canvas = this.canvasElement;\n\n    var croppingParams = null;\n\n    var argbData = data;\n\n    var ctx = canvas.getContext('2d');\n    var imageData = ctx.getImageData(0, 0, width, height);\n    imageData.data.set(argbData);\n\n    if(croppingParams === null) {\n        ctx.putImageData(imageData, 0, 0);\n    } else {\n        ctx.putImageData(imageData, -croppingParams.left, -croppingParams.top, 0, 0, croppingParams.width, croppingParams.height);\n    }\n}\n","import VideoSuperDecoder from '../index';\nimport { createWorker } from '../../../utils';\nimport Renderer from './renderer';\nimport workerString from './decoder.worker';\n\nexport default class VideoDecoder extends VideoSuperDecoder {\n    constructor(flv, decoder) {\n        super(flv, decoder);\n        const { player, events } = flv;\n        this.decoderWorker = createWorker(workerString);\n        this.renderer = new Renderer(player.$canvas);\n\n        events.proxy(this.decoderWorker, 'message', event => {\n            const message = event.data;\n            switch (message.type) {\n                case 'pictureReady':\n                    flv.emit('decoding', message, message.data.byteLength);\n                    break;\n                default:\n                    break;\n            }\n        });\n\n        flv.on('videoData', (frame, timestamp) => {\n            this.decoderWorker.postMessage({ type: 'decode', data: frame.buffer }, [frame.buffer]);\n            flv.emit('befoerdecoding', timestamp);\n        });\n    }\n\n    getFramesSize(framesIndex) {\n        let framesSize = 0;\n        for (let index = 0; index < framesIndex; index++) {\n            framesSize += this.videoframes[index].data.byteLength;\n        }\n        return framesSize;\n    }\n}\n"],"names":["_typeof","createWorker","workerString","Worker","URL","createObjectURL","Blob","type","getNowTime","performance","now","Date","calculationRate","callback","totalSize","lastTime","size","thisTime","diffTime","VideoSuperDecoder","flv","decoder","options","player","debug","ready","playing","playIndex","videoframes","timestamps","videoInputLength","videoOutputLength","decoding","byteSize","loaded","decoderRate","rate","emit","drawRate","on","decoderWorker","terminate","stop","timestamp","live","hasAudio","length","frameRate","shift","push","message","currentTime","index","undefined","draw","framesSize","getFramesSize","cache","videoChunk","splice","log","total","yuv","videoframe","renderer","drawFrame","startTime","findIndex","H264bsdCanvas","canvas","forceNoGL","canvasElement","initContextGL","contextGL","initProgram","initBuffers","initTextures","prototype","isWebGL","gl","validContextNames","nameIndex","contextName","getContext","e","getParameter","vertexShaderScript","join","fragmentShaderScript","vertexShader","createShader","VERTEX_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","console","getShaderInfoLog","fragmentShader","FRAGMENT_SHADER","program","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","useProgram","shaderProgram","vertexPosBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","vertexPosRef","getAttribLocation","enableVertexAttribArray","vertexAttribPointer","FLOAT","texturePosBuffer","texturePosRef","yTextureRef","initTexture","ySamplerRef","getUniformLocation","uniform1i","uTextureRef","uSamplerRef","vTextureRef","vSamplerRef","textureRef","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","frame","width","height","data","croppingParams","drawNextOuptutPictureGL","Uint8Array","drawNextOuptutPictureRGBA","viewport","tTop","top","tLeft","left","tBottom","tRight","texturePosValues","DYNAMIC_DRAW","i420Data","yDataLength","yData","subarray","activeTexture","TEXTURE0","texImage2D","LUMINANCE","UNSIGNED_BYTE","cbDataLength","cbData","TEXTURE1","crDataLength","crData","TEXTURE2","drawArrays","TRIANGLE_STRIP","argbData","ctx","imageData","getImageData","set","putImageData","VideoDecoder","events","Renderer","$canvas","proxy","event","byteLength","postMessage","buffer","framesIndex"],"mappings":"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"}
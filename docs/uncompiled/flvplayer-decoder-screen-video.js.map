{"version":3,"file":"flvplayer-decoder-screen-video.js","sources":["../../node_modules/@babel/runtime/helpers/classCallCheck.js","../../node_modules/@babel/runtime/helpers/createClass.js","../../node_modules/@babel/runtime/helpers/setPrototypeOf.js","../../node_modules/@babel/runtime/helpers/inherits.js","../../node_modules/@babel/runtime/helpers/typeof.js","../../node_modules/@babel/runtime/helpers/assertThisInitialized.js","../../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js","../../node_modules/@babel/runtime/helpers/getPrototypeOf.js","../../src/utils/index.js","../../src/decoder/video/index.js","../../src/decoder/video/screenvideo/renderer.js","../../src/decoder/video/screenvideo/index.js"],"sourcesContent":["function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","function _setPrototypeOf(o, p) {\n  module.exports = _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nmodule.exports = _setPrototypeOf;","var setPrototypeOf = require(\"./setPrototypeOf\");\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}\n\nmodule.exports = _inherits;","function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    module.exports = _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    module.exports = _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nmodule.exports = _typeof;","function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nmodule.exports = _assertThisInitialized;","var _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nvar assertThisInitialized = require(\"./assertThisInitialized\");\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return assertThisInitialized(self);\n}\n\nmodule.exports = _possibleConstructorReturn;","function _getPrototypeOf(o) {\n  module.exports = _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nmodule.exports = _getPrototypeOf;","export function isMobile() {\n    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n}\n\nexport function isWechat() {\n    return /MicroMessenger/i.test(navigator.userAgent);\n}\n\nexport function hasOwnProperty(obj, name) {\n    return Object.prototype.hasOwnProperty.call(obj, name);\n}\n\nexport function readBuffer(buffer) {\n    let index = 0;\n    function read(length) {\n        const tempUint8 = new Uint8Array(length);\n        for (let i = 0; i < length; i += 1) {\n            tempUint8[i] = buffer[index];\n            index += 1;\n        }\n        read.index = index;\n        return tempUint8;\n    }\n    read.index = 0;\n    return read;\n}\n\nexport function mergeBuffer(...buffers) {\n    const Cons = buffers[0].constructor;\n    return buffers.reduce((pre, val) => {\n        const merge = new Cons((pre.byteLength | 0) + (val.byteLength | 0));\n        merge.set(pre, 0);\n        merge.set(val, pre.byteLength | 0);\n        return merge;\n    }, new Cons());\n}\n\nexport function createWorker(workerString) {\n    return new Worker(URL.createObjectURL(new Blob([workerString], { type: 'application/javascript' })));\n}\n\nexport function secondToTime(second) {\n    const add0 = num => (num < 10 ? `0${num}` : String(num));\n    const hour = Math.floor(second / 3600);\n    const min = Math.floor((second - hour * 3600) / 60);\n    const sec = Math.floor(second - hour * 3600 - min * 60);\n    return (hour > 0 ? [hour, min, sec] : [min, sec]).map(add0).join(':');\n}\n\nexport function getNowTime() {\n    if (performance && typeof performance.now === 'function') {\n        return performance.now();\n    }\n    return Date.now();\n}\n\nexport function debounce(func, wait, context) {\n    let timeout;\n    function fn(...args) {\n        const later = function later() {\n            timeout = null;\n            func.apply(context, args);\n        };\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n    }\n\n    fn.clearTimeout = function ct() {\n        clearTimeout(timeout);\n    };\n\n    return fn;\n}\n\nexport function throttle(callback, delay) {\n    let isThrottled = false;\n    let args;\n    let context;\n\n    function fn(...args2) {\n        if (isThrottled) {\n            args = args2;\n            context = this;\n            return;\n        }\n\n        isThrottled = true;\n        callback.apply(this, args2);\n        setTimeout(() => {\n            isThrottled = false;\n            if (args) {\n                fn.apply(context, args);\n                args = null;\n                context = null;\n            }\n        }, delay);\n    }\n\n    return fn;\n}\n\nexport function clamp(num, a, b) {\n    return Math.max(Math.min(num, Math.max(a, b)), Math.min(a, b));\n}\n\nexport function setStyle(element, key, value) {\n    if (typeof key === 'object') {\n        Object.keys(key).forEach(item => {\n            setStyle(element, item, key[item]);\n        });\n    }\n    element.style[key] = value;\n    return element;\n}\n\nexport function getStyle(element, key, numberType = true) {\n    const value = getComputedStyle(element, null).getPropertyValue(key);\n    return numberType ? parseFloat(value) : value;\n}\n\nexport function loadScript(url, name) {\n    return new Promise((resolve, reject) => {\n        const $script = document.createElement('script');\n        $script.type = 'text/javascript';\n        $script.onload = () => {\n            if (window[name]) {\n                resolve(window[name]);\n            } else {\n                reject(new Error(`Unable to find global variable '${name}' from '${url}'`));\n            }\n        };\n        $script.onerror = () => {\n            reject(new Error(`Resource loading failed '${url}'`));\n        };\n        $script.src = url;\n        document.head.appendChild($script);\n    });\n}\n\nexport function proxyPropertys(target, ...sources) {\n    return sources.reduce((result, source) => {\n        Object.getOwnPropertyNames(source).forEach(key => {\n            if (!hasOwnProperty(result, key)) {\n                Object.defineProperty(result, key, Object.getOwnPropertyDescriptor(source, key));\n            } else {\n                throw new Error(`Target attribute name is duplicated: ${key}`);\n            }\n        });\n        return result;\n    }, target);\n}\n\nexport function calculationRate(callback) {\n    let totalSize = 0;\n    let lastTime = getNowTime();\n    return size => {\n        totalSize += size;\n        const thisTime = getNowTime();\n        const diffTime = thisTime - lastTime;\n        if (diffTime >= 1000) {\n            callback((totalSize / diffTime) * 1000);\n            lastTime = thisTime;\n            totalSize = 0;\n        }\n    };\n}\n","import { calculationRate } from '../../utils';\n\nexport default class VideoSuperDecoder {\n    constructor(flv, decoder) {\n        this.flv = flv;\n        const { options, player, debug } = flv;\n\n        this.ready = false;\n        this.playing = false;\n        this.playIndex = 0;\n        this.videoframes = [];\n        this.timestamps = [];\n        this.videoInputLength = 0;\n        this.videoOutputLength = 0;\n        this.decoding = false;\n        this.byteSize = 0;\n        this.loaded = 0;\n\n        this.decoderRate = calculationRate(rate => {\n            flv.emit('decoderRate', rate);\n        });\n\n        this.drawRate = calculationRate(rate => {\n            flv.emit('drawRate', rate);\n        });\n\n        flv.on('destroy', () => {\n            this.videoframes = [];\n            this.timestamps = [];\n            this.decoderWorker.terminate();\n            this.decoderWorker = null;\n            this.stop();\n        });\n\n        flv.on('befoerdecoding', timestamp => {\n            if (options.live && options.hasAudio && !this.playing && this.timestamps.length >= player.frameRate) {\n                this.timestamps.shift();\n            }\n            this.timestamps.push(timestamp);\n            this.decoding = true;\n            this.videoInputLength += 1;\n        });\n\n        flv.on('decoding', (message, byteSize) => {\n            if (options.live && options.hasAudio && !this.playing && this.timestamps.length >= player.frameRate) {\n                this.videoframes.shift();\n            }\n            this.videoframes.push(message);\n            this.byteSize += byteSize;\n            this.videoOutputLength += 1;\n            this.decoding = this.videoInputLength !== this.videoOutputLength;\n            this.loaded = this.videoOutputLength / player.frameRate;\n            flv.emit('videoLoaded', this.loaded);\n            this.decoderRate(1);\n            if (!this.ready && this.videoOutputLength === 1) {\n                this.ready = true;\n                if (options.live) {\n                    decoder.currentTime = this.timestamps[0] / 1000;\n                }\n                flv.emit('ready');\n            }\n        });\n\n        flv.on('timeupdate', currentTime => {\n            const index = this.playIndex;\n            const timestamp = this.timestamps[index];\n            if (timestamp !== undefined && currentTime * 1000 >= timestamp) {\n                if (this.draw(index)) {\n                    const framesSize = this.getFramesSize(index);\n                    if (\n                        (options.live || !options.cache) &&\n                        framesSize >= options.videoChunk * 64 &&\n                        this.videoframes.length - 1 > index &&\n                        this.timestamps.length - 1 > index\n                    ) {\n                        this.playIndex = 0;\n                        this.videoframes.splice(0, index + 1);\n                        this.timestamps.splice(0, index + 1);\n                        decoder.currentTime = this.timestamps[0] / 1000;\n                        debug.log('free-video-memory', {\n                            total: this.byteSize,\n                            yuv: framesSize,\n                            index,\n                        });\n                        flv.emit('freeVideoMemory', framesSize, index);\n                    } else {\n                        this.playIndex += 1;\n                    }\n                } else {\n                    if (!options.live) {\n                        this.stop();\n                    }\n                }\n            }\n        });\n    }\n\n    draw(index) {\n        const videoframe = this.videoframes[index];\n        if (!videoframe) return false;\n        this.renderer.drawFrame(videoframe);\n        this.drawRate(1);\n        return true;\n    }\n\n    play(startTime = 0) {\n        this.playing = true;\n        if (this.flv.options.live) {\n            this.playIndex = 0;\n            this.flv.decoder.currentTime = (this.timestamps[0] || 0) / 1000;\n        } else {\n            this.playIndex = this.timestamps.findIndex(timestamp => {\n                return timestamp >= startTime * 1000;\n            });\n        }\n    }\n\n    stop() {\n        this.playing = false;\n        if (this.flv.options.live) {\n            this.playIndex = 0;\n        }\n    }\n}\n","\nexport default function FlashScreenVideoCanvas(canvas) {\n    this.canvasElement = canvas;\n\n    if(this.contextGL) {\n        this.initProgram();\n    }\n}\n\n/**\n * Draw picture data to the canvas.\n * Otherwise, data must be an RGBA formatted ArrayBuffer.\n */\nFlashScreenVideoCanvas.prototype.drawFrame = function(frame) {\n    var { width, height, data } = frame;\n    var croppingParams = null;\n\n    this.drawNextOuptutPictureRGBA(width, height, croppingParams, new Uint8Array(data));\n}\n\n/**\n * Draw next output picture using ARGB data on a 2d canvas.\n */\nFlashScreenVideoCanvas.prototype.drawNextOuptutPictureRGBA = function(width, height, croppingParams, data) {\n    var canvas = this.canvasElement;\n\n    var croppingParams = null;\n\n    var argbData = data;\n\n    var ctx = canvas.getContext('2d');\n    var imageData = ctx.getImageData(0, 0, width, height);\n     imageData.data.set(argbData);\n\n    if (croppingParams === null) {\n        ctx.putImageData(imageData, 0, 0);\n    } else {\n        ctx.putImageData(imageData, -croppingParams.left, -croppingParams.top, 0, 0, croppingParams.width, croppingParams.height);\n    }\n}\n","import VideoSuperDecoder from '../index';\nimport Renderer from './renderer';\n\nexport default class VideoDecoder extends VideoSuperDecoder {\n    constructor(flv, decoder) {\n        super(flv, decoder);\n        const { player, events } = flv;\n        this.renderer = new Renderer(player.$canvas);\n\n        flv.on('fsVideoData', (frame, timestamp) => {\n            flv.emit('befoerdecoding', timestamp);\n            flv.emit('decoding', frame, frame.data.byteLength);\n        });\n    }\n\n    getFramesSize(framesIndex) {\n        let framesSize = 0;\n        for (let index = 0; index < framesIndex; index++) {\n            framesSize += this.videoframes[index].data.byteLength;\n        }\n        return framesSize;\n    }\n}\n"],"names":["_typeof","getNowTime","performance","now","Date","calculationRate","callback","totalSize","lastTime","size","thisTime","diffTime","VideoSuperDecoder","flv","decoder","options","player","debug","ready","playing","playIndex","videoframes","timestamps","videoInputLength","videoOutputLength","decoding","byteSize","loaded","decoderRate","rate","emit","drawRate","on","decoderWorker","terminate","stop","timestamp","live","hasAudio","length","frameRate","shift","push","message","currentTime","index","undefined","draw","framesSize","getFramesSize","cache","videoChunk","splice","log","total","yuv","videoframe","renderer","drawFrame","startTime","findIndex","FlashScreenVideoCanvas","canvas","canvasElement","contextGL","initProgram","prototype","frame","width","height","data","croppingParams","drawNextOuptutPictureRGBA","Uint8Array","argbData","ctx","getContext","imageData","getImageData","set","putImageData","left","top","VideoDecoder","events","Renderer","$canvas","byteLength","framesIndex"],"mappings":"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"}